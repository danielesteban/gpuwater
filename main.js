!function(){"use strict";class e{static NoiseType=Object.freeze({OpenSimplex2:"OpenSimplex2",OpenSimplex2S:"OpenSimplex2S",Cellular:"Cellular",Perlin:"Perlin",ValueCubic:"ValueCubic",Value:"Value"});static RotationType3D=Object.freeze({None:"None",ImproveXYPlanes:"ImproveXYPlanes",ImproveXZPlanes:"ImproveXZPlanes"});static FractalType=Object.freeze({None:"None",FBm:"FBm",Ridged:"Ridged",PingPong:"PingPong",DomainWarpProgressive:"DomainWarpProgressive",DomainWarpIndependent:"DomainWarpIndependent"});static CellularDistanceFunction=Object.freeze({Euclidean:"Euclidean",EuclideanSq:"EuclideanSq",Manhattan:"Manhattan",Hybrid:"Hybrid"});static CellularReturnType=Object.freeze({CellValue:"CellValue",Distance:"Distance",Distance2:"Distance2",Distance2Add:"Distance2Add",Distance2Sub:"Distance2Sub",Distance2Mul:"Distance2Mul",Distance2Div:"Distance2Div"});static DomainWarpType=Object.freeze({OpenSimplex2:"OpenSimplex2",OpenSimplex2Reduced:"OpenSimplex2Reduced",BasicGrid:"BasicGrid"});static TransformType3D=Object.freeze({None:"None",ImproveXYPlanes:"ImproveXYPlanes",ImproveXZPlanes:"ImproveXZPlanes",DefaultOpenSimplex2:"DefaultOpenSimplex2"});_Seed=1337;_Frequency=.01;_NoiseType=e.NoiseType.OpenSimplex2;_RotationType3D=e.RotationType3D.None;_TransformType3D=e.TransformType3D.DefaultOpenSimplex2;_DomainWarpAmp=1;_FractalType=e.FractalType.None;_Octaves=3;_Lacunarity=2;_Gain=.5;_WeightedStrength=0;_PingPongStrength=2;_FractalBounding=1/1.75;_CellularDistanceFunction=e.CellularDistanceFunction.EuclideanSq;_CellularReturnType=e.CellularReturnType.Distance;_CellularJitterModifier=1;_DomainWarpType=e.DomainWarpType.OpenSimplex2;_WarpTransformType3D=e.TransformType3D.DefaultOpenSimplex2;constructor(e){void 0!==e&&(this._Seed=e)}SetSeed(e){this._Seed=e}SetFrequency(e){this._Frequency=e}SetNoiseType(e){this._NoiseType=e,this._UpdateTransformType3D()}SetRotationType3D(e){this._RotationType3D=e,this._UpdateTransformType3D(),this._UpdateWarpTransformType3D()}SetFractalType(e){this._FractalType=e}SetFractalOctaves(e){this._Octaves=e,this._CalculateFractalBounding()}SetFractalLacunarity(e){this._Lacunarity=e}SetFractalGain(e){this._Gain=e,this._CalculateFractalBounding()}SetFractalWeightedStrength(e){this._WeightedStrength=e}SetFractalPingPongStrength(e){this._PingPongStrength=e}SetCellularDistanceFunction(e){this._CellularDistanceFunction=e}SetCellularReturnType(e){this._CellularReturnType=e}SetCellularJitter(e){this._CellularJitterModifier=e}SetDomainWarpType(e){this._DomainWarpType=e,this._UpdateWarpTransformType3D()}SetDomainWarpAmp(e){this._DomainWarpAmp=e}GetNoise(t,i,r){let a=(t,i)=>{switch(t*=this._Frequency,i*=this._Frequency,this._NoiseType){case e.NoiseType.OpenSimplex2:case e.NoiseType.OpenSimplex2S:let r=(t+i)*(.5*(1.7320508075688772-1));t+=r,i+=r}switch(this._FractalType){default:return this._GenNoiseSingleR2(this._Seed,t,i);case e.FractalType.FBm:return this._GenFractalFBmR2(t,i);case e.FractalType.Ridged:return this._GenFractalRidgedR2(t,i);case e.FractalType.PingPong:return this._GenFractalPingPongR2(t,i)}},s=(t,i,r)=>{switch(t*=this._Frequency,i*=this._Frequency,r*=this._Frequency,this._TransformType3D){case e.TransformType3D.ImproveXYPlanes:{let e=t+i,a=-.211324865405187*e;t+=a-(r*=.577350269189626),i+=a-r,r+=.577350269189626*e;break}case e.TransformType3D.ImproveXZPlanes:{let e=t+r,a=-.211324865405187*e;t+=a-(i*=.577350269189626),r+=a-i,i+=.577350269189626*e;break}case e.TransformType3D.DefaultOpenSimplex2:let a=(t+i+r)*(2/3);t=a-t,i=a-i,r=a-r}switch(this._FractalType){default:return this._GenNoiseSingleR3(this._Seed,t,i,r);case e.FractalType.FBm:return this._GenFractalFBmR3(t,i,r);case e.FractalType.Ridged:return this._GenFractalRidgedR3(t,i,r);case e.FractalType.PingPong:return this._GenFractalPingPongR3(t,i,r)}};return 2===arguments.length?a(t,i):3===arguments.length?s(t,i,r):void 0}DomainWrap(t){switch(this._FractalType){default:this._DomainWarpSingle(t);break;case e.FractalType.DomainWarpProgressive:this._DomainWarpFractalProgressive(t);break;case e.FractalType.DomainWarpIndependent:this._DomainWarpFractalIndependent(t)}}_Gradients2D=[.130526192220052,.99144486137381,.38268343236509,.923879532511287,.608761429008721,.793353340291235,.793353340291235,.608761429008721,.923879532511287,.38268343236509,.99144486137381,.130526192220051,.99144486137381,-.130526192220051,.923879532511287,-.38268343236509,.793353340291235,-.60876142900872,.608761429008721,-.793353340291235,.38268343236509,-.923879532511287,.130526192220052,-.99144486137381,-.130526192220052,-.99144486137381,-.38268343236509,-.923879532511287,-.608761429008721,-.793353340291235,-.793353340291235,-.608761429008721,-.923879532511287,-.38268343236509,-.99144486137381,-.130526192220052,-.99144486137381,.130526192220051,-.923879532511287,.38268343236509,-.793353340291235,.608761429008721,-.608761429008721,.793353340291235,-.38268343236509,.923879532511287,-.130526192220052,.99144486137381,.130526192220052,.99144486137381,.38268343236509,.923879532511287,.608761429008721,.793353340291235,.793353340291235,.608761429008721,.923879532511287,.38268343236509,.99144486137381,.130526192220051,.99144486137381,-.130526192220051,.923879532511287,-.38268343236509,.793353340291235,-.60876142900872,.608761429008721,-.793353340291235,.38268343236509,-.923879532511287,.130526192220052,-.99144486137381,-.130526192220052,-.99144486137381,-.38268343236509,-.923879532511287,-.608761429008721,-.793353340291235,-.793353340291235,-.608761429008721,-.923879532511287,-.38268343236509,-.99144486137381,-.130526192220052,-.99144486137381,.130526192220051,-.923879532511287,.38268343236509,-.793353340291235,.608761429008721,-.608761429008721,.793353340291235,-.38268343236509,.923879532511287,-.130526192220052,.99144486137381,.130526192220052,.99144486137381,.38268343236509,.923879532511287,.608761429008721,.793353340291235,.793353340291235,.608761429008721,.923879532511287,.38268343236509,.99144486137381,.130526192220051,.99144486137381,-.130526192220051,.923879532511287,-.38268343236509,.793353340291235,-.60876142900872,.608761429008721,-.793353340291235,.38268343236509,-.923879532511287,.130526192220052,-.99144486137381,-.130526192220052,-.99144486137381,-.38268343236509,-.923879532511287,-.608761429008721,-.793353340291235,-.793353340291235,-.608761429008721,-.923879532511287,-.38268343236509,-.99144486137381,-.130526192220052,-.99144486137381,.130526192220051,-.923879532511287,.38268343236509,-.793353340291235,.608761429008721,-.608761429008721,.793353340291235,-.38268343236509,.923879532511287,-.130526192220052,.99144486137381,.130526192220052,.99144486137381,.38268343236509,.923879532511287,.608761429008721,.793353340291235,.793353340291235,.608761429008721,.923879532511287,.38268343236509,.99144486137381,.130526192220051,.99144486137381,-.130526192220051,.923879532511287,-.38268343236509,.793353340291235,-.60876142900872,.608761429008721,-.793353340291235,.38268343236509,-.923879532511287,.130526192220052,-.99144486137381,-.130526192220052,-.99144486137381,-.38268343236509,-.923879532511287,-.608761429008721,-.793353340291235,-.793353340291235,-.608761429008721,-.923879532511287,-.38268343236509,-.99144486137381,-.130526192220052,-.99144486137381,.130526192220051,-.923879532511287,.38268343236509,-.793353340291235,.608761429008721,-.608761429008721,.793353340291235,-.38268343236509,.923879532511287,-.130526192220052,.99144486137381,.130526192220052,.99144486137381,.38268343236509,.923879532511287,.608761429008721,.793353340291235,.793353340291235,.608761429008721,.923879532511287,.38268343236509,.99144486137381,.130526192220051,.99144486137381,-.130526192220051,.923879532511287,-.38268343236509,.793353340291235,-.60876142900872,.608761429008721,-.793353340291235,.38268343236509,-.923879532511287,.130526192220052,-.99144486137381,-.130526192220052,-.99144486137381,-.38268343236509,-.923879532511287,-.608761429008721,-.793353340291235,-.793353340291235,-.608761429008721,-.923879532511287,-.38268343236509,-.99144486137381,-.130526192220052,-.99144486137381,.130526192220051,-.923879532511287,.38268343236509,-.793353340291235,.608761429008721,-.608761429008721,.793353340291235,-.38268343236509,.923879532511287,-.130526192220052,.99144486137381,.38268343236509,.923879532511287,.923879532511287,.38268343236509,.923879532511287,-.38268343236509,.38268343236509,-.923879532511287,-.38268343236509,-.923879532511287,-.923879532511287,-.38268343236509,-.923879532511287,.38268343236509,-.38268343236509,.923879532511287];_RandVecs2D=[-.2700222198,-.9628540911,.3863092627,-.9223693152,.04444859006,-.999011673,-.5992523158,-.8005602176,-.7819280288,.6233687174,.9464672271,.3227999196,-.6514146797,-.7587218957,.9378472289,.347048376,-.8497875957,-.5271252623,-.879042592,.4767432447,-.892300288,-.4514423508,-.379844434,-.9250503802,-.9951650832,.0982163789,.7724397808,-.6350880136,.7573283322,-.6530343002,-.9928004525,-.119780055,-.0532665713,.9985803285,.9754253726,-.2203300762,-.7665018163,.6422421394,.991636706,.1290606184,-.994696838,.1028503788,-.5379205513,-.84299554,.5022815471,-.8647041387,.4559821461,-.8899889226,-.8659131224,-.5001944266,.0879458407,-.9961252577,-.5051684983,.8630207346,.7753185226,-.6315704146,-.6921944612,.7217110418,-.5191659449,-.8546734591,.8978622882,-.4402764035,-.1706774107,.9853269617,-.9353430106,-.3537420705,-.9992404798,.03896746794,-.2882064021,-.9575683108,-.9663811329,.2571137995,-.8759714238,-.4823630009,-.8303123018,-.5572983775,.05110133755,-.9986934731,-.8558373281,-.5172450752,.09887025282,.9951003332,.9189016087,.3944867976,-.2439375892,-.9697909324,-.8121409387,-.5834613061,-.9910431363,.1335421355,.8492423985,-.5280031709,-.9717838994,-.2358729591,.9949457207,.1004142068,.6241065508,-.7813392434,.662910307,.7486988212,-.7197418176,.6942418282,-.8143370775,-.5803922158,.104521054,-.9945226741,-.1065926113,-.9943027784,.445799684,-.8951327509,.105547406,.9944142724,-.992790267,.1198644477,-.8334366408,.552615025,.9115561563,-.4111755999,.8285544909,-.5599084351,.7217097654,-.6921957921,.4940492677,-.8694339084,-.3652321272,-.9309164803,-.9696606758,.2444548501,.08925509731,-.996008799,.5354071276,-.8445941083,-.1053576186,.9944343981,-.9890284586,.1477251101,.004856104961,.9999882091,.9885598478,.1508291331,.9286129562,-.3710498316,-.5832393863,-.8123003252,.3015207509,.9534596146,-.9575110528,.2883965738,.9715802154,-.2367105511,.229981792,.9731949318,.955763816,-.2941352207,.740956116,.6715534485,-.9971513787,-.07542630764,.6905710663,-.7232645452,-.290713703,-.9568100872,.5912777791,-.8064679708,-.9454592212,-.325740481,.6664455681,.74555369,.6236134912,.7817328275,.9126993851,-.4086316587,-.8191762011,.5735419353,-.8812745759,-.4726046147,.9953313627,.09651672651,.9855650846,-.1692969699,-.8495980887,.5274306472,.6174853946,-.7865823463,.8508156371,.52546432,.9985032451,-.05469249926,.1971371563,-.9803759185,.6607855748,-.7505747292,-.03097494063,.9995201614,-.6731660801,.739491331,-.7195018362,-.6944905383,.9727511689,.2318515979,.9997059088,-.0242506907,.4421787429,-.8969269532,.9981350961,-.061043673,-.9173660799,-.3980445648,-.8150056635,-.5794529907,-.8789331304,.4769450202,.0158605829,.999874213,-.8095464474,.5870558317,-.9165898907,-.3998286786,-.8023542565,.5968480938,-.5176737917,.8555780767,-.8154407307,-.5788405779,.4022010347,-.9155513791,-.9052556868,-.4248672045,.7317445619,.6815789728,-.5647632201,-.8252529947,-.8403276335,-.5420788397,-.9314281527,.363925262,.5238198472,.8518290719,.7432803869,-.6689800195,-.985371561,-.1704197369,.4601468731,.88784281,.825855404,.5638819483,.6182366099,.7859920446,.8331502863,-.553046653,.1500307506,.9886813308,-.662330369,-.7492119075,-.668598664,.743623444,.7025606278,.7116238924,-.5419389763,-.8404178401,-.3388616456,.9408362159,.8331530315,.5530425174,-.2989720662,-.9542618632,.2638522993,.9645630949,.124108739,-.9922686234,-.7282649308,-.6852956957,.6962500149,.7177993569,-.9183535368,.3957610156,-.6326102274,-.7744703352,-.9331891859,-.359385508,-.1153779357,-.9933216659,.9514974788,-.3076565421,-.08987977445,-.9959526224,.6678496916,.7442961705,.7952400393,-.6062947138,-.6462007402,-.7631674805,-.2733598753,.9619118351,.9669590226,-.254931851,-.9792894595,.2024651934,-.5369502995,-.8436138784,-.270036471,-.9628500944,-.6400277131,.7683518247,-.7854537493,-.6189203566,.06005905383,-.9981948257,-.02455770378,.9996984141,-.65983623,.751409442,-.6253894466,-.7803127835,-.6210408851,-.7837781695,.8348888491,.5504185768,-.1592275245,.9872419133,.8367622488,.5475663786,-.8675753916,-.4973056806,-.2022662628,-.9793305667,.9399189937,.3413975472,.9877404807,-.1561049093,-.9034455656,.4287028224,.1269804218,-.9919052235,-.3819600854,.924178821,.9754625894,.2201652486,-.3204015856,-.9472818081,-.9874760884,.1577687387,.02535348474,-.9996785487,.4835130794,-.8753371362,-.2850799925,-.9585037287,-.06805516006,-.99768156,-.7885244045,-.6150034663,.3185392127,-.9479096845,.8880043089,.4598351306,.6476921488,-.7619021462,.9820241299,.1887554194,.9357275128,-.3527237187,-.8894895414,.4569555293,.7922791302,.6101588153,.7483818261,.6632681526,-.7288929755,-.6846276581,.8729032783,-.4878932944,.8288345784,.5594937369,.08074567077,.9967347374,.9799148216,-.1994165048,-.580730673,-.8140957471,-.4700049791,-.8826637636,.2409492979,.9705377045,.9437816757,-.3305694308,-.8927998638,-.4504535528,-.8069622304,.5906030467,.06258973166,.9980393407,-.9312597469,.3643559849,.5777449785,.8162173362,-.3360095855,-.941858566,.697932075,-.7161639607,-.002008157227,-.9999979837,-.1827294312,-.9831632392,-.6523911722,.7578824173,-.4302626911,-.9027037258,-.9985126289,-.05452091251,-.01028102172,-.9999471489,-.4946071129,.8691166802,-.2999350194,.9539596344,.8165471961,.5772786819,.2697460475,.962931498,-.7306287391,-.6827749597,-.7590952064,-.6509796216,-.907053853,.4210146171,-.5104861064,-.8598860013,.8613350597,.5080373165,.5007881595,-.8655698812,-.654158152,.7563577938,-.8382755311,-.545246856,.6940070834,.7199681717,.06950936031,.9975812994,.1702942185,-.9853932612,.2695973274,.9629731466,.5519612192,-.8338697815,.225657487,-.9742067022,.4215262855,-.9068161835,.4881873305,-.8727388672,-.3683854996,-.9296731273,-.9825390578,.1860564427,.81256471,.5828709909,.3196460933,-.9475370046,.9570913859,.2897862643,-.6876655497,-.7260276109,-.9988770922,-.047376731,-.1250179027,.992154486,-.8280133617,.560708367,.9324863769,-.3612051451,.6394653183,.7688199442,-.01623847064,-.9998681473,-.9955014666,-.09474613458,-.81453315,.580117012,.4037327978,-.9148769469,.9944263371,.1054336766,-.1624711654,.9867132919,-.9949487814,-.100383875,-.6995302564,.7146029809,.5263414922,-.85027327,-.5395221479,.841971408,.6579370318,.7530729462,.01426758847,-.9998982128,-.6734383991,.7392433447,.639412098,-.7688642071,.9211571421,.3891908523,-.146637214,-.9891903394,-.782318098,.6228791163,-.5039610839,-.8637263605,-.7743120191,-.6328039957];_Gradients3D=[0,1,1,0,0,-1,1,0,0,1,-1,0,0,-1,-1,0,1,0,1,0,-1,0,1,0,1,0,-1,0,-1,0,-1,0,1,1,0,0,-1,1,0,0,1,-1,0,0,-1,-1,0,0,0,1,1,0,0,-1,1,0,0,1,-1,0,0,-1,-1,0,1,0,1,0,-1,0,1,0,1,0,-1,0,-1,0,-1,0,1,1,0,0,-1,1,0,0,1,-1,0,0,-1,-1,0,0,0,1,1,0,0,-1,1,0,0,1,-1,0,0,-1,-1,0,1,0,1,0,-1,0,1,0,1,0,-1,0,-1,0,-1,0,1,1,0,0,-1,1,0,0,1,-1,0,0,-1,-1,0,0,0,1,1,0,0,-1,1,0,0,1,-1,0,0,-1,-1,0,1,0,1,0,-1,0,1,0,1,0,-1,0,-1,0,-1,0,1,1,0,0,-1,1,0,0,1,-1,0,0,-1,-1,0,0,0,1,1,0,0,-1,1,0,0,1,-1,0,0,-1,-1,0,1,0,1,0,-1,0,1,0,1,0,-1,0,-1,0,-1,0,1,1,0,0,-1,1,0,0,1,-1,0,0,-1,-1,0,0,1,1,0,0,0,-1,1,0,-1,1,0,0,0,-1,-1,0];_RandVecs3D=[-.7292736885,-.6618439697,.1735581948,0,.790292081,-.5480887466,-.2739291014,0,.7217578935,.6226212466,-.3023380997,0,.565683137,-.8208298145,-.0790000257,0,.760049034,-.5555979497,-.3370999617,0,.3713945616,.5011264475,.7816254623,0,-.1277062463,-.4254438999,-.8959289049,0,-.2881560924,-.5815838982,.7607405838,0,.5849561111,-.662820239,-.4674352136,0,.3307171178,.0391653737,.94291689,0,.8712121778,-.4113374369,-.2679381538,0,.580981015,.7021915846,.4115677815,0,.503756873,.6330056931,-.5878203852,0,.4493712205,.601390195,.6606022552,0,-.6878403724,.09018890807,-.7202371714,0,-.5958956522,-.6469350577,.475797649,0,-.5127052122,.1946921978,-.8361987284,0,-.9911507142,-.05410276466,-.1212153153,0,-.2149721042,.9720882117,-.09397607749,0,-.7518650936,-.5428057603,.3742469607,0,.5237068895,.8516377189,-.02107817834,0,.6333504779,.1926167129,-.7495104896,0,-.06788241606,.3998305789,.9140719259,0,-.5538628599,-.4729896695,-.6852128902,0,-.7261455366,-.5911990757,.3509933228,0,-.9229274737,-.1782808786,.3412049336,0,-.6968815002,.6511274338,.3006480328,0,.9608044783,-.2098363234,-.1811724921,0,.06817146062,-.9743405129,.2145069156,0,-.3577285196,-.6697087264,-.6507845481,0,-.1868621131,.7648617052,-.6164974636,0,-.6541697588,.3967914832,.6439087246,0,.6993340405,-.6164538506,.3618239211,0,-.1546665739,.6291283928,.7617583057,0,-.6841612949,-.2580482182,-.6821542638,0,.5383980957,.4258654885,.7271630328,0,-.5026987823,-.7939832935,-.3418836993,0,.3202971715,.2834415347,.9039195862,0,.8683227101,-.0003762656404,-.4959995258,0,.791120031,-.08511045745,.6057105799,0,-.04011016052,-.4397248749,.8972364289,0,.9145119872,.3579346169,-.1885487608,0,-.9612039066,-.2756484276,.01024666929,0,.6510361721,-.2877799159,-.7023778346,0,-.2041786351,.7365237271,.644859585,0,-.7718263711,.3790626912,.5104855816,0,-.3060082741,-.7692987727,.5608371729,0,.454007341,-.5024843065,.7357899537,0,.4816795475,.6021208291,-.6367380315,0,.6961980369,-.3222197429,.641469197,0,-.6532160499,-.6781148932,.3368515753,0,.5089301236,-.6154662304,-.6018234363,0,-.1635919754,-.9133604627,-.372840892,0,.52408019,-.8437664109,.1157505864,0,.5902587356,.4983817807,-.6349883666,0,.5863227872,.494764745,.6414307729,0,.6779335087,.2341345225,.6968408593,0,.7177054546,-.6858979348,.120178631,0,-.5328819713,-.5205125012,.6671608058,0,-.8654874251,-.0700727088,-.4960053754,0,-.2861810166,.7952089234,.5345495242,0,-.04849529634,.9810836427,-.1874115585,0,-.6358521667,.6058348682,.4781800233,0,.6254794696,-.2861619734,.7258696564,0,-.2585259868,.5061949264,-.8227581726,0,.02136306781,.5064016808,-.8620330371,0,.200111773,.8599263484,.4695550591,0,.4743561372,.6014985084,-.6427953014,0,.6622993731,-.5202474575,-.5391679918,0,.08084972818,-.6532720452,.7527940996,0,-.6893687501,.0592860349,.7219805347,0,-.1121887082,-.9673185067,.2273952515,0,.7344116094,.5979668656,-.3210532909,0,.5789393465,-.2488849713,.7764570201,0,.6988182827,.3557169806,-.6205791146,0,-.8636845529,-.2748771249,-.4224826141,0,-.4247027957,-.4640880967,.777335046,0,.5257722489,-.8427017621,.1158329937,0,.9343830603,.316302472,-.1639543925,0,-.1016836419,-.8057303073,-.5834887393,0,-.6529238969,.50602126,-.5635892736,0,-.2465286165,-.9668205684,-.06694497494,0,-.9776897119,-.2099250524,-.007368825344,0,.7736893337,.5734244712,.2694238123,0,-.6095087895,.4995678998,.6155736747,0,.5794535482,.7434546771,.3339292269,0,-.8226211154,.08142581855,.5627293636,0,-.510385483,.4703667658,.7199039967,0,-.5764971849,-.07231656274,-.8138926898,0,.7250628871,.3949971505,-.5641463116,0,-.1525424005,.4860840828,-.8604958341,0,-.5550976208,-.4957820792,.667882296,0,-.1883614327,.9145869398,.357841725,0,.7625556724,-.5414408243,-.3540489801,0,-.5870231946,-.3226498013,-.7424963803,0,.3051124198,.2262544068,-.9250488391,0,.6379576059,.577242424,-.5097070502,0,-.5966775796,.1454852398,-.7891830656,0,-.658330573,.6555487542,-.3699414651,0,.7434892426,.2351084581,.6260573129,0,.5562114096,.8264360377,-.0873632843,0,-.3028940016,-.8251527185,.4768419182,0,.1129343818,-.985888439,-.1235710781,0,.5937652891,-.5896813806,.5474656618,0,.6757964092,-.5835758614,-.4502648413,0,.7242302609,-.1152719764,.6798550586,0,-.9511914166,.0753623979,-.2992580792,0,.2539470961,-.1886339355,.9486454084,0,.571433621,-.1679450851,-.8032795685,0,-.06778234979,.3978269256,.9149531629,0,.6074972649,.733060024,-.3058922593,0,-.5435478392,.1675822484,.8224791405,0,-.5876678086,-.3380045064,-.7351186982,0,-.7967562402,.04097822706,-.6029098428,0,-.1996350917,.8706294745,.4496111079,0,-.02787660336,-.9106232682,-.4122962022,0,-.7797625996,-.6257634692,.01975775581,0,-.5211232846,.7401644346,-.4249554471,0,.8575424857,.4053272873,-.3167501783,0,.1045223322,.8390195772,-.5339674439,0,.3501822831,.9242524096,-.1520850155,0,.1987849858,.07647613266,.9770547224,0,.7845996363,.6066256811,-.1280964233,0,.09006737436,-.9750989929,-.2026569073,0,-.8274343547,-.542299559,.1458203587,0,-.3485797732,-.415802277,.840000362,0,-.2471778936,-.7304819962,-.6366310879,0,-.3700154943,.8577948156,.3567584454,0,.5913394901,-.548311967,-.5913303597,0,.1204873514,-.7626472379,-.6354935001,0,.616959265,.03079647928,.7863922953,0,.1258156836,-.6640829889,-.7369967419,0,-.6477565124,-.1740147258,-.7417077429,0,.6217889313,-.7804430448,-.06547655076,0,.6589943422,-.6096987708,.4404473475,0,-.2689837504,-.6732403169,-.6887635427,0,-.3849775103,.5676542638,.7277093879,0,.5754444408,.8110471154,-.1051963504,0,.9141593684,.3832947817,.131900567,0,-.107925319,.9245493968,.3654593525,0,.377977089,.3043148782,.8743716458,0,-.2142885215,-.8259286236,.5214617324,0,.5802544474,.4148098596,-.7008834116,0,-.1982660881,.8567161266,-.4761596756,0,-.03381553704,.3773180787,-.9254661404,0,-.6867922841,-.6656597827,.2919133642,0,.7731742607,-.2875793547,-.5652430251,0,-.09655941928,.9193708367,-.3813575004,0,.2715702457,-.9577909544,-.09426605581,0,.2451015704,-.6917998565,-.6792188003,0,.977700782,-.1753855374,.1155036542,0,-.5224739938,.8521606816,.02903615945,0,-.7734880599,-.5261292347,.3534179531,0,-.7134492443,-.269547243,.6467878011,0,.1644037271,.5105846203,-.8439637196,0,.6494635788,.05585611296,.7583384168,0,-.4711970882,.5017280509,-.7254255765,0,-.6335764307,-.2381686273,-.7361091029,0,-.9021533097,-.270947803,-.3357181763,0,-.3793711033,.872258117,.3086152025,0,-.6855598966,-.3250143309,.6514394162,0,.2900942212,-.7799057743,-.5546100667,0,-.2098319339,.85037073,.4825351604,0,-.4592603758,.6598504336,-.5947077538,0,.8715945488,.09616365406,-.4807031248,0,-.6776666319,.7118504878,-.1844907016,0,.7044377633,.312427597,.637304036,0,-.7052318886,-.2401093292,-.6670798253,0,.081921007,-.7207336136,-.6883545647,0,-.6993680906,-.5875763221,-.4069869034,0,-.1281454481,.6419895885,.7559286424,0,-.6337388239,-.6785471501,-.3714146849,0,.5565051903,-.2168887573,-.8020356851,0,-.5791554484,.7244372011,-.3738578718,0,.1175779076,-.7096451073,.6946792478,0,-.6134619607,.1323631078,.7785527795,0,.6984635305,-.02980516237,-.715024719,0,.8318082963,-.3930171956,.3919597455,0,.1469576422,.05541651717,-.9875892167,0,.708868575,-.2690503865,.6520101478,0,.2726053183,.67369766,-.68688995,0,-.6591295371,.3035458599,-.6880466294,0,.4815131379,-.7528270071,.4487723203,0,.9430009463,.1675647412,-.2875261255,0,.434802957,.7695304522,-.4677277752,0,.3931996188,.594473625,.7014236729,0,.7254336655,-.603925654,.3301814672,0,.7590235227,-.6506083235,.02433313207,0,-.8552768592,-.3430042733,.3883935666,0,-.6139746835,.6981725247,.3682257648,0,-.7465905486,-.5752009504,.3342849376,0,.5730065677,.810555537,-.1210916791,0,-.9225877367,-.3475211012,-.167514036,0,-.7105816789,-.4719692027,-.5218416899,0,-.08564609717,.3583001386,.929669703,0,-.8279697606,-.2043157126,.5222271202,0,.427944023,.278165994,.8599346446,0,.5399079671,-.7857120652,-.3019204161,0,.5678404253,-.5495413974,-.6128307303,0,-.9896071041,.1365639107,-.04503418428,0,-.6154342638,-.6440875597,.4543037336,0,.1074204368,-.7946340692,.5975094525,0,-.3595449969,-.8885529948,.28495784,0,-.2180405296,.1529888965,.9638738118,0,-.7277432317,-.6164050508,-.3007234646,0,.7249729114,-.00669719484,.6887448187,0,-.5553659455,-.5336586252,.6377908264,0,.5137558015,.7976208196,-.3160000073,0,-.3794024848,.9245608561,-.03522751494,0,.8229248658,.2745365933,-.4974176556,0,-.5404114394,.6091141441,.5804613989,0,.8036581901,-.2703029469,.5301601931,0,.6044318879,.6832968393,.4095943388,0,.06389988817,.9658208605,-.2512108074,0,.1087113286,.7402471173,-.6634877936,0,-.713427712,-.6926784018,.1059128479,0,.6458897819,-.5724548511,-.5050958653,0,-.6553931414,.7381471625,.159995615,0,.3910961323,.9188871375,-.05186755998,0,-.4879022471,-.5904376907,.6429111375,0,.6014790094,.7707441366,-.2101820095,0,-.5677173047,.7511360995,.3368851762,0,.7858573506,.226674665,.5753666838,0,-.4520345543,-.604222686,-.6561857263,0,.002272116345,.4132844051,-.9105991643,0,-.5815751419,-.5162925989,.6286591339,0,-.03703704785,.8273785755,.5604221175,0,-.5119692504,.7953543429,-.3244980058,0,-.2682417366,-.9572290247,-.1084387619,0,-.2322482736,-.9679131102,-.09594243324,0,.3554328906,-.8881505545,.2913006227,0,.7346520519,-.4371373164,.5188422971,0,.9985120116,.04659011161,-.02833944577,0,-.3727687496,-.9082481361,.1900757285,0,.91737377,-.3483642108,.1925298489,0,.2714911074,.4147529736,-.8684886582,0,.5131763485,-.7116334161,.4798207128,0,-.8737353606,.18886992,-.4482350644,0,.8460043821,-.3725217914,.3814499973,0,.8978727456,-.1780209141,-.4026575304,0,.2178065647,-.9698322841,-.1094789531,0,-.1518031304,-.7788918132,-.6085091231,0,-.2600384876,-.4755398075,-.8403819825,0,.572313509,-.7474340931,-.3373418503,0,-.7174141009,.1699017182,-.6756111411,0,-.684180784,.02145707593,-.7289967412,0,-.2007447902,.06555605789,-.9774476623,0,-.1148803697,-.8044887315,.5827524187,0,-.7870349638,.03447489231,.6159443543,0,-.2015596421,.6859872284,.6991389226,0,-.08581082512,-.10920836,-.9903080513,0,.5532693395,.7325250401,-.396610771,0,-.1842489331,-.9777375055,-.1004076743,0,.0775473789,-.9111505856,.4047110257,0,.1399838409,.7601631212,-.6344734459,0,.4484419361,-.845289248,.2904925424,0];_PrimeX=501125321;_PrimeY=1136930381;_PrimeZ=1720413743;static _Lerp(e,t,i){return e+i*(t-e)}static _InterpHermite(e){return e*e*(3-2*e)}static _InterpQuintic(e){return e*e*e*(e*(6*e-15)+10)}static _CubicLerp(e,t,i,r,a){let s=r-i-(e-t);return a*a*a*s+a*a*(e-t-s)+a*(i-e)+t}static _PingPong(e){return(e-=Math.trunc(.5*e*2))<1?e:2-e}_CalculateFractalBounding(){let e=Math.abs(this._Gain),t=e,i=1;for(let r=1;r<this._Octaves;r++)i+=t,t*=e;this._FractalBounding=1/i}_HashR2(e,t,i){let r=Math.trunc(e^t^i);return r=668265261*r>>>0,r}_HashR3(e,t,i,r){let a=Math.trunc(e^t^i^r);return a=668265261*a>>>0,a}_ValCoordR2(e,t,i){let r=this._HashR2(e,t,i);return r*=r,r^=r<<19,r*(1/2147483648)}_ValCoordR3(e,t,i,r){let a=this._HashR3(e,t,i,r);return a*=a,a^=a<<19,a*(1/2147483648)}_GradCoordR2(e,t,i,r,a){let s=this._HashR2(e,t,i);return s^=s>>15,s&=254,r*this._Gradients2D[s]+a*this._Gradients2D[1|s]}_GradCoordR3(e,t,i,r,a,s,n){let o=this._HashR3(e,t,i,r);return o^=o>>15,o&=252,a*this._Gradients3D[o]+s*this._Gradients3D[1|o]+n*this._Gradients3D[2|o]}_GenNoiseSingleR2(t,i,r){switch(this._NoiseType){case e.NoiseType.OpenSimplex2:return this._SingleOpenSimplex2R2(t,i,r);case e.NoiseType.OpenSimplex2S:return this._SingleOpenSimplex2SR2(t,i,r);case e.NoiseType.Cellular:return this._SingleCellularR2(t,i,r);case e.NoiseType.Perlin:return this._SinglePerlinR2(t,i,r);case e.NoiseType.ValueCubic:return this._SingleValueCubicR2(t,i,r);case e.NoiseType.Value:return this._SingleValueR2(t,i,r);default:return 0}}_GenNoiseSingleR3(t,i,r,a){switch(this._NoiseType){case e.NoiseType.OpenSimplex2:return this._SingleOpenSimplex2R3(t,i,r,a);case e.NoiseType.OpenSimplex2S:return this._SingleOpenSimplex2SR3(t,i,r,a);case e.NoiseType.Cellular:return this._SingleCellularR3(t,i,r,a);case e.NoiseType.Perlin:return this._SinglePerlinR3(t,i,r,a);case e.NoiseType.ValueCubic:return this._SingleValueCubicR3(t,i,r,a);case e.NoiseType.Value:return this._SingleValueR3(t,i,r,a);default:return 0}}_UpdateTransformType3D(){switch(this._RotationType3D){case e.RotationType3D.ImproveXYPlanes:this._TransformType3D=e.TransformType3D.ImproveXYPlanes;break;case e.RotationType3D.ImproveXZPlanes:this._TransformType3D=e.TransformType3D.ImproveXZPlanes;break;default:switch(this._NoiseType){case e.NoiseType.OpenSimplex2:case e.NoiseType.OpenSimplex2S:this._TransformType3D=e.TransformType3D.DefaultOpenSimplex2;break;default:this._TransformType3D=e.TransformType3D.None}}}_UpdateWarpTransformType3D(){switch(this._RotationType3D){case e.RotationType3D.ImproveXYPlanes:this._WarpTransformType3D=e.TransformType3D.ImproveXYPlanes;break;case e.RotationType3D.ImproveXZPlanes:this._WarpTransformType3D=e.TransformType3D.ImproveXZPlanes;break;default:switch(this._DomainWarpType){case e.DomainWarpType.OpenSimplex2:case e.DomainWarpType.OpenSimplex2Reduced:this._WarpTransformType3D=e.TransformType3D.DefaultOpenSimplex2;break;default:this._WarpTransformType3D=e.TransformType3D.None}}}_GenFractalFBmR2(t,i){let r=this._Seed,a=0,s=this._FractalBounding;for(let n=0;n<this._Octaves;n++){let n=this._GenNoiseSingleR2(r++,t,i);a+=n*s,s*=e._Lerp(1,.5*Math.min(n+1,2),this._WeightedStrength),t*=this._Lacunarity,i*=this._Lacunarity,s*=this._Gain}return a}_GenFractalFBmR3(t,i,r){let a=this._Seed,s=0,n=this._FractalBounding;for(let o=0;o<this._Octaves;o++){let o=this._GenNoiseSingleR3(a++,t,i,r);s+=o*n,n*=e._Lerp(1,.5*(o+1),this._WeightedStrength),t*=this._Lacunarity,i*=this._Lacunarity,r*=this._Lacunarity,n*=this._Gain}return s}_GenFractalRidgedR2(t,i){let r=this._Seed,a=0,s=this._FractalBounding;for(let n=0;n<this._Octaves;n++){let n=Math.abs(this._GenNoiseSingleR2(r++,t,i));a+=(-2*n+1)*s,s*=e._Lerp(1,1-n,this._WeightedStrength),t*=this._Lacunarity,i*=this._Lacunarity,s*=this._Gain}return a}_GenFractalRidgedR3(t,i,r){let a=this._Seed,s=0,n=this._FractalBounding;for(let o=0;o<this._Octaves;o++){let o=Math.abs(this._GenNoiseSingleR3(a++,t,i,r));s+=(-2*o+1)*n,n*=e._Lerp(1,1-o,this._WeightedStrength),t*=this._Lacunarity,i*=this._Lacunarity,r*=this._Lacunarity,n*=this._Gain}return s}_GenFractalPingPongR2(t,i){let r=this._Seed,a=0,s=this._FractalBounding;for(let n=0;n<this._Octaves;n++){let n=e._PingPong((this._GenNoiseSingleR2(r++,t,i)+1)*this._PingPongStrength);a+=2*(n-.5)*s,s*=e._Lerp(1,n,this._WeightedStrength),t*=this._Lacunarity,i*=this._Lacunarity,s*=this._Gain}return a}_GenFractalPingPongR3(t,i,r){let a=this._Seed,s=0,n=this._FractalBounding;for(let o=0;o<this._Octaves;o++){let o=e._PingPong((this._GenNoiseSingleR3(a++,t,i,r)+1)*this._PingPongStrength);s+=2*(o-.5)*n,n*=e._Lerp(1,o,this._WeightedStrength),t*=this._Lacunarity,i*=this._Lacunarity,r*=this._Lacunarity,n*=this._Gain}return s}_SingleOpenSimplex2R2(e,t,i){const r=.21132486540518713;let a,s,n,o=Math.floor(t),l=Math.floor(i),h=t-o,_=i-l,c=(h+_)*r,p=h-c,u=_-c;o*=this._PrimeX,l*=this._PrimeY;let d=.5-p*p-u*u;a=d<=0?0:d*d*(d*d)*this._GradCoordR2(e,o,l,p,u);let m=3.1547005383792506*c+(-.6666666666666666+d);if(m<=0)n=0;else{let t=p+(2*r-1),i=u+(2*r-1);n=m*m*(m*m)*this._GradCoordR2(e,o+this._PrimeX,l+this._PrimeY,t,i)}if(u>p){let t=p+r,i=u+(r-1),a=.5-t*t-i*i;s=a<=0?0:a*a*(a*a)*this._GradCoordR2(e,o,l+this._PrimeY,t,i)}else{let t=p+(r-1),i=u+r,a=.5-t*t-i*i;s=a<=0?0:a*a*(a*a)*this._GradCoordR2(e,o+this._PrimeX,l,t,i)}return 99.83685446303647*(a+s+n)}_SingleOpenSimplex2R3(e,t,i,r){let a=Math.round(t),s=Math.round(i),n=Math.round(r),o=t-a,l=i-s,h=r-n,_=Math.trunc(-1-l|1),c=Math.trunc(-1-o|1),p=Math.trunc(-1-h|1),u=c*-o,d=_*-l,m=p*-h;a*=this._PrimeX,s*=this._PrimeY,n*=this._PrimeZ;let R=0,f=.6-o*o-(l*l+h*h);for(let t=0;;t++){if(f>0&&(R+=f*f*(f*f)*this._GradCoordR3(e,a,s,n,o,l,h)),u>=d&&u>=m){let t=f+u+u;t>1&&(t-=1,R+=t*t*(t*t)*this._GradCoordR3(e,a-c*this._PrimeX,s,n,o+c,l,h))}else if(d>u&&d>=m){let t=f+d+d;t>1&&(t-=1,R+=t*t*(t*t)*this._GradCoordR3(e,a,s-_*this._PrimeY,n,o,l+_,h))}else{let t=f+m+m;t>1&&(t-=1,R+=t*t*(t*t)*this._GradCoordR3(e,a,s,n-p*this._PrimeZ,o,l,h+p))}if(1===t)break;u=.5-u,d=.5-d,m=.5-m,o=c*u,l=_*d,h=p*m,f+=.75-u-(d+m),a+=c>>1&this._PrimeX,s+=_>>1&this._PrimeY,n+=p>>1&this._PrimeZ,c=-c,_=-_,p=-p,e=~e}return 32.69428253173828*R}_SingleOpenSimplex2SR2(e,t,i){const r=.21132486540518713;let a=Math.floor(t),s=Math.floor(i),n=t-a,o=i-s;a*=this._PrimeX,s*=this._PrimeY;let l=a+this._PrimeX,h=s+this._PrimeY,_=(n+o)*r,c=n-_,p=o-_,u=2/3-c*c-p*p,d=u*u*(u*u)*this._GradCoordR2(e,a,s,c,p),m=3.1547005383792506*_+(-.6666666666666666+u),R=c-(1-2*r),f=p-(1-2*r);d+=m*m*(m*m)*this._GradCoordR2(e,l,h,R,f);let g=n-o;if(_>r){if(n+g>1){let t=c+(3*r-2),i=p+(3*r-1),n=2/3-t*t-i*i;n>0&&(d+=n*n*(n*n)*this._GradCoordR2(e,a+(this._PrimeX<<1),s+this._PrimeY,t,i))}else{let t=c+r,i=p+(r-1),n=2/3-t*t-i*i;n>0&&(d+=n*n*(n*n)*this._GradCoordR2(e,a,s+this._PrimeY,t,i))}if(o-g>1){let t=c+(3*r-1),i=p+(3*r-2),n=2/3-t*t-i*i;n>0&&(d+=n*n*(n*n)*this._GradCoordR2(e,a+this._PrimeX,s+(this._PrimeY<<1),t,i))}else{let t=c+(r-1),i=p+r,n=2/3-t*t-i*i;n>0&&(d+=n*n*(n*n)*this._GradCoordR2(e,a+this._PrimeX,s,t,i))}}else{if(n+g<0){let t=c+(1-r),i=p-r,n=2/3-t*t-i*i;n>0&&(d+=n*n*(n*n)*this._GradCoordR2(e,a-this._PrimeX,s,t,i))}else{let t=c+(r-1),i=p+r,n=2/3-t*t-i*i;n>0&&(d+=n*n*(n*n)*this._GradCoordR2(e,a+this._PrimeX,s,t,i))}if(o<g){let t=c-r,i=p-(r-1),n=2/3-t*t-i*i;n>0&&(d+=n*n*(n*n)*this._GradCoordR2(e,a,s-this._PrimeY,t,i))}else{let t=c+r,i=p+(r-1),n=2/3-t*t-i*i;n>0&&(d+=n*n*(n*n)*this._GradCoordR2(e,a,s+this._PrimeY,t,i))}}return 18.24196194486065*d}_SingleOpenSimplex2SR3(e,t,i,r){let a=Math.floor(t),s=Math.floor(i),n=Math.floor(r),o=t-a,l=i-s,h=r-n;a*=this._PrimeX,s*=this._PrimeY,n*=this._PrimeZ;let _=e+1293373,c=Math.trunc(-.5-o),p=Math.trunc(-.5-l),u=Math.trunc(-.5-h),d=o+c,m=l+p,R=h+u,f=.75-d*d-m*m-R*R,g=f*f*(f*f)*this._GradCoordR3(e,a+(c&this._PrimeX),s+(p&this._PrimeY),n+(u&this._PrimeZ),d,m,R),D=o-.5,P=l-.5,y=h-.5,C=.75-D*D-P*P-y*y;g+=C*C*(C*C)*this._GradCoordR3(_,a+this._PrimeX,s+this._PrimeY,n+this._PrimeZ,D,P,y);let T=((1|c)<<1)*D,S=((1|p)<<1)*P,V=((1|u)<<1)*y,b=(-2-(c<<2))*D-1,v=(-2-(p<<2))*P-1,G=(-2-(u<<2))*y-1,M=!1,L=T+f;if(L>0){let t=d-(1|c);g+=L*L*(L*L)*this._GradCoordR3(e,a+(~c&this._PrimeX),s+(p&this._PrimeY),n+(u&this._PrimeZ),t,m,R)}else{let t=S+V+f;if(t>0){let i=d,r=m-(1|p),o=R-(1|u);g+=t*t*(t*t)*this._GradCoordR3(e,a+(c&this._PrimeX),s+(~p&this._PrimeY),n+(~u&this._PrimeZ),i,r,o)}let i=b+C;if(i>0){let e=(1|c)+D;g+=i*i*(i*i)*this._GradCoordR3(_,a+(c&2*this._PrimeX),s+this._PrimeY,n+this._PrimeZ,e,P,y),M=!0}}let x=!1,w=S+f;if(w>0){let t=d,i=m-(1|p);g+=w*w*(w*w)*this._GradCoordR3(e,a+(c&this._PrimeX),s+(~p&this._PrimeY),n+(u&this._PrimeZ),t,i,R)}else{let t=T+V+f;if(t>0){let i=d-(1|c),r=m,o=R-(1|u);g+=t*t*(t*t)*this._GradCoordR3(e,a+(~c&this._PrimeX),s+(p&this._PrimeY),n+(~u&this._PrimeZ),i,r,o)}let i=v+C;if(i>0){let e=D,t=(1|p)+P;g+=i*i*(i*i)*this._GradCoordR3(_,a+this._PrimeX,s+(p&this._PrimeY<<1),n+this._PrimeZ,e,t,y),x=!0}}let F=!1,X=V+f;if(X>0){let t=d,i=m,r=R-(1|u);g+=X*X*(X*X)*this._GradCoordR3(e,a+(c&this._PrimeX),s+(p&this._PrimeY),n+(~u&this._PrimeZ),t,i,r)}else{let t=T+S+f;if(t>0){let i=d-(1|c),r=m-(1|p);g+=t*t*(t*t)*this._GradCoordR3(e,a+(~c&this._PrimeX),s+(~p&this._PrimeY),n+(u&this._PrimeZ),i,r,R)}let i=G+C;if(i>0){let e=D,t=P,r=(1|u)+y;g+=i*i*(i*i)*this._GradCoordR3(_,a+this._PrimeX,s+this._PrimeY,n+(u&this._PrimeZ<<1),e,t,r),F=!0}}if(!M){let e=v+G+C;if(e>0){let t=D,i=(1|p)+P,r=(1|u)+y;g+=e*e*(e*e)*this._GradCoordR3(_,a+this._PrimeX,s+(p&this._PrimeY<<1),n+(u&this._PrimeZ<<1),t,i,r)}}if(!x){let e=b+G+C;if(e>0){let t=(1|c)+D,i=P,r=(1|u)+y;g+=e*e*(e*e)*this._GradCoordR3(_,a+(c&2*this._PrimeX),s+this._PrimeY,n+(u&this._PrimeZ<<1),t,i,r)}}if(!F){let e=b+v+C;if(e>0){let t=(1|c)+D,i=(1|p)+P;g+=e*e*(e*e)*this._GradCoordR3(_,a+(c&this._PrimeX<<1),s+(p&this._PrimeY<<1),n+this._PrimeZ,t,i,y)}}return 9.046026385208288*g}_SingleCellularR2(t,i,r){let a=Math.round(i),s=Math.round(r),n=Number.MAX_VALUE,o=Number.MAX_VALUE,l=0,h=.43701595*this._CellularJitterModifier,_=(a-1)*this._PrimeX,c=(s-1)*this._PrimeY;switch(this._CellularDistanceFunction){default:case e.CellularDistanceFunction.Euclidean:case e.CellularDistanceFunction.EuclideanSq:for(let e=a-1;e<=a+1;e++){let a=c;for(let c=s-1;c<=s+1;c++){let s=this._HashR2(t,_,a),p=510&s,u=e-i+this._RandVecs2D[p]*h,d=c-r+this._RandVecs2D[1|p]*h,m=u*u+d*d;o=Math.max(Math.min(o,m),n),m<n&&(n=m,l=s),a+=this._PrimeY}_+=this._PrimeX}break;case e.CellularDistanceFunction.Manhattan:for(let e=a-1;e<=a+1;e++){let a=c;for(let c=s-1;c<=s+1;c++){let s=this._HashR2(t,_,a),p=510&s,u=e-i+this._RandVecs2D[p]*h,d=c-r+this._RandVecs2D[1|p]*h,m=Math.abs(u)+Math.abs(d);o=Math.max(Math.min(o,m),n),m<n&&(n=m,l=s),a+=this._PrimeY}_+=this._PrimeX}break;case e.CellularDistanceFunction.Hybrid:for(let e=a-1;e<=a+1;e++){let a=c;for(let c=s-1;c<=s+1;c++){let s=this._HashR2(t,_,a),p=510&s,u=e-i+this._RandVecs2D[p]*h,d=c-r+this._RandVecs2D[1|p]*h,m=Math.abs(u)+Math.abs(d)+(u*u+d*d);o=Math.max(Math.min(o,m),n),m<n&&(n=m,l=s),a+=this._PrimeY}_+=this._PrimeX}}switch(this._CellularDistanceFunction===e.CellularDistanceFunction.Euclidean&&this._CellularReturnType!==e.CellularReturnType.CellValue&&(n=Math.sqrt(n),this._CellularReturnType!==e.CellularReturnType.CellValue&&(o=Math.sqrt(o))),this._CellularReturnType){case e.CellularReturnType.CellValue:return l*(1/2147483648);case e.CellularReturnType.Distance:return n-1;case e.CellularReturnType.Distance2:return o-1;case e.CellularReturnType.Distance2Add:return.5*(o+n)-1;case e.CellularReturnType.Distance2Sub:return o-n-1;case e.CellularReturnType.Distance2Mul:return o*n*.5-1;case e.CellularReturnType.Distance2Div:return n/o-1;default:return 0}}_SingleCellularR3(t,i,r,a){let s=Math.round(i),n=Math.round(r),o=Math.round(a),l=Number.MAX_VALUE,h=Number.MAX_VALUE,_=0,c=.39614353*this._CellularJitterModifier,p=(s-1)*this._PrimeX,u=(n-1)*this._PrimeY,d=(o-1)*this._PrimeZ;switch(this._CellularDistanceFunction){case e.CellularDistanceFunction.Euclidean:case e.CellularDistanceFunction.EuclideanSq:for(let e=s-1;e<=s+1;e++){let s=u;for(let u=n-1;u<=n+1;u++){let n=d;for(let d=o-1;d<=o+1;d++){let o=this._HashR3(t,p,s,n),m=1020&o,R=e-i+this._RandVecs3D[m]*c,f=u-r+this._RandVecs3D[1|m]*c,g=d-a+this._RandVecs3D[2|m]*c,D=R*R+f*f+g*g;h=Math.max(Math.min(h,D),l),D<l&&(l=D,_=o),n+=this._PrimeZ}s+=this._PrimeY}p+=this._PrimeX}break;case e.CellularDistanceFunction.Manhattan:for(let e=s-1;e<=s+1;e++){let s=u;for(let u=n-1;u<=n+1;u++){let n=d;for(let d=o-1;d<=o+1;d++){let o=this._HashR3(t,p,s,n),m=1020&o,R=e-i+this._RandVecs3D[m]*c,f=u-r+this._RandVecs3D[1|m]*c,g=d-a+this._RandVecs3D[2|m]*c,D=Math.abs(R)+Math.abs(f)+Math.abs(g);h=Math.max(Math.min(h,D),l),D<l&&(l=D,_=o),n+=this._PrimeZ}s+=this._PrimeY}p+=this._PrimeX}break;case e.CellularDistanceFunction.Hybrid:for(let e=s-1;e<=s+1;e++){let s=u;for(let u=n-1;u<=n+1;u++){let n=d;for(let d=o-1;d<=o+1;d++){let o=this._HashR3(t,p,s,n),m=1020&o,R=e-i+this._RandVecs3D[m]*c,f=u-r+this._RandVecs3D[1|m]*c,g=d-a+this._RandVecs3D[2|m]*c,D=Math.abs(R)+Math.abs(f)+Math.abs(g)+(R*R+f*f+g*g);h=Math.max(Math.min(h,D),l),D<l&&(l=D,_=o),n+=this._PrimeZ}s+=this._PrimeY}p+=this._PrimeX}}switch(this._CellularDistanceFunction===e.CellularDistanceFunction.Euclidean&&this._CellularReturnType!==e.CellularReturnType.CellValue&&(l=Math.sqrt(l),this._CellularReturnType!==e.CellularReturnType.CellValue&&(h=Math.sqrt(h))),this._CellularReturnType){case e.CellularReturnType.CellValue:return _*(1/2147483648);case e.CellularReturnType.Distance:return l-1;case e.CellularReturnType.Distance2:return h-1;case e.CellularReturnType.Distance2Add:return.5*(h+l)-1;case e.CellularReturnType.Distance2Sub:return h-l-1;case e.CellularReturnType.Distance2Mul:return h*l*.5-1;case e.CellularReturnType.Distance2Div:return l/h-1;default:return 0}}_SinglePerlinR2(t,i,r){let a=Math.floor(i),s=Math.floor(r),n=i-a,o=r-s,l=n-1,h=o-1,_=e._InterpQuintic(n),c=e._InterpQuintic(o);a*=this._PrimeX,s*=this._PrimeY;let p=a+this._PrimeX,u=s+this._PrimeY,d=e._Lerp(this._GradCoordR2(t,a,s,n,o),this._GradCoordR2(t,p,s,l,o),_),m=e._Lerp(this._GradCoordR2(t,a,u,n,h),this._GradCoordR2(t,p,u,l,h),_);return 1.4247691104677813*e._Lerp(d,m,c)}_SinglePerlinR3(t,i,r,a){let s=Math.floor(i),n=Math.floor(r),o=Math.floor(a),l=i-s,h=r-n,_=a-o,c=l-1,p=h-1,u=_-1,d=e._InterpQuintic(l),m=e._InterpQuintic(h),R=e._InterpQuintic(_);s*=this._PrimeX,n*=this._PrimeY,o*=this._PrimeZ;let f=s+this._PrimeX,g=n+this._PrimeY,D=o+this._PrimeZ,P=e._Lerp(this._GradCoordR3(t,s,n,o,l,h,_),this._GradCoordR3(t,f,n,o,c,h,_),d),y=e._Lerp(this._GradCoordR3(t,s,g,o,l,p,_),this._GradCoordR3(t,f,g,o,c,p,_),d),C=e._Lerp(this._GradCoordR3(t,s,n,D,l,h,u),this._GradCoordR3(t,f,n,D,c,h,u),d),T=e._Lerp(this._GradCoordR3(t,s,g,D,l,p,u),this._GradCoordR3(t,f,g,D,c,p,u),d),S=e._Lerp(P,y,m),V=e._Lerp(C,T,m);return.9649214148521423*e._Lerp(S,V,R)}_SingleValueCubicR2(t,i,r){let a=Math.floor(i),s=Math.floor(r),n=i-a,o=r-s;a*=this._PrimeX,s*=this._PrimeY;let l=a-this._PrimeX,h=s-this._PrimeY,_=a+this._PrimeX,c=s+this._PrimeY,p=a+(this._PrimeX<<1),u=s+(this._PrimeY<<1);return e._CubicLerp(e._CubicLerp(this._ValCoordR2(t,l,h),this._ValCoordR2(t,a,h),this._ValCoordR2(t,_,h),this._ValCoordR2(t,p,h),n),e._CubicLerp(this._ValCoordR2(t,l,s),this._ValCoordR2(t,a,s),this._ValCoordR2(t,_,s),this._ValCoordR2(t,p,s),n),e._CubicLerp(this._ValCoordR2(t,l,c),this._ValCoordR2(t,a,c),this._ValCoordR2(t,_,c),this._ValCoordR2(t,p,c),n),e._CubicLerp(this._ValCoordR2(t,l,u),this._ValCoordR2(t,a,u),this._ValCoordR2(t,_,u),this._ValCoordR2(t,p,u),n),o)*(1/2.25)}_SingleValueCubicR3(t,i,r,a){let s=Math.floor(i),n=Math.floor(r),o=Math.floor(a),l=i-s,h=r-n,_=a-o;s*=this._PrimeX,n*=this._PrimeY,o*=this._PrimeZ;let c=s-this._PrimeX,p=n-this._PrimeY,u=o-this._PrimeZ,d=s+this._PrimeX,m=n+this._PrimeY,R=o+this._PrimeZ,f=s+(this._PrimeX<<1),g=n+(this._PrimeY<<1),D=o+(this._PrimeZ<<1);return e._CubicLerp(e._CubicLerp(e._CubicLerp(this._ValCoordR3(t,c,p,u),this._ValCoordR3(t,s,p,u),this._ValCoordR3(t,d,p,u),this._ValCoordR3(t,f,p,u),l),e._CubicLerp(this._ValCoordR3(t,c,n,u),this._ValCoordR3(t,s,n,u),this._ValCoordR3(t,d,n,u),this._ValCoordR3(t,f,n,u),l),e._CubicLerp(this._ValCoordR3(t,c,m,u),this._ValCoordR3(t,s,m,u),this._ValCoordR3(t,d,m,u),this._ValCoordR3(t,f,m,u),l),e._CubicLerp(this._ValCoordR3(t,c,g,u),this._ValCoordR3(t,s,g,u),this._ValCoordR3(t,d,g,u),this._ValCoordR3(t,f,g,u),l),h),e._CubicLerp(e._CubicLerp(this._ValCoordR3(t,c,p,o),this._ValCoordR3(t,s,p,o),this._ValCoordR3(t,d,p,o),this._ValCoordR3(t,f,p,o),l),e._CubicLerp(this._ValCoordR3(t,c,n,o),this._ValCoordR3(t,s,n,o),this._ValCoordR3(t,d,n,o),this._ValCoordR3(t,f,n,o),l),e._CubicLerp(this._ValCoordR3(t,c,m,o),this._ValCoordR3(t,s,m,o),this._ValCoordR3(t,d,m,o),this._ValCoordR3(t,f,m,o),l),e._CubicLerp(this._ValCoordR3(t,c,g,o),this._ValCoordR3(t,s,g,o),this._ValCoordR3(t,d,g,o),this._ValCoordR3(t,f,g,o),l),h),e._CubicLerp(e._CubicLerp(this._ValCoordR3(t,c,p,R),this._ValCoordR3(t,s,p,R),this._ValCoordR3(t,d,p,R),this._ValCoordR3(t,f,p,R),l),e._CubicLerp(this._ValCoordR3(t,c,n,R),this._ValCoordR3(t,s,n,R),this._ValCoordR3(t,d,n,R),this._ValCoordR3(t,f,n,R),l),e._CubicLerp(this._ValCoordR3(t,c,m,R),this._ValCoordR3(t,s,m,R),this._ValCoordR3(t,d,m,R),this._ValCoordR3(t,f,m,R),l),e._CubicLerp(this._ValCoordR3(t,c,g,R),this._ValCoordR3(t,s,g,R),this._ValCoordR3(t,d,g,R),this._ValCoordR3(t,f,g,R),l),h),e._CubicLerp(e._CubicLerp(this._ValCoordR3(t,c,p,D),this._ValCoordR3(t,s,p,D),this._ValCoordR3(t,d,p,D),this._ValCoordR3(t,f,p,D),l),e._CubicLerp(this._ValCoordR3(t,c,n,D),this._ValCoordR3(t,s,n,D),this._ValCoordR3(t,d,n,D),this._ValCoordR3(t,f,n,D),l),e._CubicLerp(this._ValCoordR3(t,c,m,D),this._ValCoordR3(t,s,m,D),this._ValCoordR3(t,d,m,D),this._ValCoordR3(t,f,m,D),l),e._CubicLerp(this._ValCoordR3(t,c,g,D),this._ValCoordR3(t,s,g,D),this._ValCoordR3(t,d,g,D),this._ValCoordR3(t,f,g,D),l),h),_)*(1/3.375)}_SingleValueR2(t,i,r){let a=Math.floor(i),s=Math.floor(r),n=e._InterpHermite(i-a),o=e._InterpHermite(r-s);a*=this._PrimeX,s*=this._PrimeY;let l=a+this._PrimeX,h=s+this._PrimeY,_=e._Lerp(this._ValCoordR2(t,a,s),this._ValCoordR2(t,l,s),n),c=e._Lerp(this._ValCoordR2(t,a,h),this._ValCoordR2(t,l,h),n);return e._Lerp(_,c,o)}_SingleValueR3(t,i,r,a){let s=Math.floor(i),n=Math.floor(r),o=Math.floor(a),l=e._InterpHermite(i-s),h=e._InterpHermite(r-n),_=e._InterpHermite(a-o);s*=this._PrimeX,n*=this._PrimeY,o*=this._PrimeZ;let c=s+this._PrimeX,p=n+this._PrimeY,u=o+this._PrimeZ,d=e._Lerp(this._ValCoordR3(t,s,n,o),this._ValCoordR3(t,c,n,o),l),m=e._Lerp(this._ValCoordR3(t,s,p,o),this._ValCoordR3(t,c,p,o),l),R=e._Lerp(this._ValCoordR3(t,s,n,u),this._ValCoordR3(t,c,n,u),l),f=e._Lerp(this._ValCoordR3(t,s,p,u),this._ValCoordR3(t,c,p,u),l),g=e._Lerp(d,m,h),D=e._Lerp(R,f,h);return e._Lerp(g,D,_)}_DoSingleDomainWarp(){let r=(t,i,r,a,s,n,o)=>{switch(this._DomainWarpType){case e.DomainWarpType.OpenSimplex2:this._SingleDomainWarpOpenSimplex2Gradient(t,32.69428253173828*i,r,a,!1,s,n,o);break;case e.DomainWarpType.OpenSimplex2Reduced:this._SingleDomainWarpOpenSimplex2Gradient(t,7.71604938271605*i,r,a,!0,s,n,o);break;case e.DomainWarpType.BasicGrid:this._SingleDomainWarpBasicGrid(t,i,r,a,s,n,o)}};return 6===arguments.length&&arguments[3]instanceof t?((t,i,r,a,s,n)=>{switch(this._DomainWarpType){case e.DomainWarpType.OpenSimplex2:this._SingleDomainWarpOpenSimplex2Gradient(t,38.283687591552734*i,r,a,!1,s,n);break;case e.DomainWarpType.OpenSimplex2Reduced:this._SingleDomainWarpOpenSimplex2Gradient(t,16*i,r,a,!0,s,n);break;case e.DomainWarpType.BasicGrid:this._SingleDomainWarpBasicGrid(t,i,r,a,s,n)}})(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]):7===arguments.length&&arguments[3]instanceof i?r(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]):void 0}_DomainWarpSingle(){let r=t=>{let i=this._Seed,r=this._DomainWarpAmp*this._FractalBounding,a=this._Frequency,s=t.x,n=t.y,o=t.z;switch(this._WarpTransformType3D){case e.TransformType3D.ImproveXYPlanes:{let e=s+n,t=-.211324865405187*e;o*=.577350269189626,s+=t-o,n=n+t-o,o+=.577350269189626*e}break;case e.TransformType3D.ImproveXZPlanes:{let e=s+o,t=-.211324865405187*e;n*=.577350269189626,s+=t-n,o+=t-n,n+=.577350269189626*e}break;case e.TransformType3D.DefaultOpenSimplex2:let t=(s+n+o)*(2/3);s=t-s,n=t-n,o=t-o}this._DoSingleDomainWarp(i,r,a,t,s,n,o)};return 1===arguments.length&&arguments[0]instanceof t?(t=>{let i=this._Seed,r=this._DomainWarpAmp*this._FractalBounding,a=this._Frequency,s=t.x,n=t.y;switch(this._DomainWarpType){case e.DomainWarpType.OpenSimplex2:case e.DomainWarpType.OpenSimplex2Reduced:let t=(s+n)*(.5*(1.7320508075688772-1));s+=t,n+=t}this._DoSingleDomainWarp(i,r,a,t,s,n)})(arguments[0]):1===arguments.length&&arguments[0]instanceof i?r(arguments[0]):void 0}_DomainWarpFractalProgressive(){let r=t=>{let i=this._Seed,r=this._DomainWarpAmp*this._FractalBounding,a=this._Frequency;for(let s=0;s<this._Octaves;s++){let s=t.x,n=t.y,o=t.z;switch(this._WarpTransformType3D){case e.TransformType3D.ImproveXYPlanes:{let e=s+n,t=-.211324865405187*e;o*=.577350269189626,s+=t-o,n=n+t-o,o+=.577350269189626*e}break;case e.TransformType3D.ImproveXZPlanes:{let e=s+o,t=-.211324865405187*e;n*=.577350269189626,s+=t-n,o+=t-n,n+=.577350269189626*e}break;case e.TransformType3D.DefaultOpenSimplex2:{let e=(s+n+o)*(2/3);s=e-s,n=e-n,o=e-o}}this._DoSingleDomainWarp(i,r,a,t,s,n,o),i++,r*=this._Gain,a*=this._Lacunarity}};return 1===arguments.length&&arguments[0]instanceof t?(t=>{let i=this._Seed,r=this._DomainWarpAmp*this._FractalBounding,a=this._Frequency;for(let s=0;s<this._Octaves;s++){let s=t.x,n=t.y;switch(this._DomainWarpType){case e.DomainWarpType.OpenSimplex2:case e.DomainWarpType.OpenSimplex2Reduced:let t=(s+n)*(.5*(1.7320508075688772-1));s+=t,n+=t}this._DoSingleDomainWarp(i,r,a,t,s,n),i++,r*=this._Gain,a*=this._Lacunarity}})(arguments[0]):1===arguments.length&&arguments[0]instanceof i?r(arguments[0]):void 0}_DomainWarpFractalIndependent(){let r=t=>{let i=t.x,r=t.y,a=t.z;switch(this._WarpTransformType3D){case e.TransformType3D.ImproveXYPlanes:{let e=i+r,t=-.211324865405187*e;a*=.577350269189626,i+=t-a,r=r+t-a,a+=.577350269189626*e}break;case e.TransformType3D.ImproveXZPlanes:{let e=i+a,t=-.211324865405187*e;r*=.577350269189626,i+=t-r,a+=t-r,r+=.577350269189626*e}break;case e.TransformType3D.DefaultOpenSimplex2:{let e=(i+r+a)*(2/3);i=e-i,r=e-r,a=e-a}}let s=this._Seed,n=this._DomainWarpAmp*this._FractalBounding,o=this._Frequency;for(let e=0;e<this._Octaves;e++)this._DoSingleDomainWarp(s,n,o,t,i,r,a),s++,n*=this._Gain,o*=this._Lacunarity};return 1===arguments.length&&arguments[0]instanceof t?(t=>{let i=t.x,r=t.y;switch(this._DomainWarpType){case e.DomainWarpType.OpenSimplex2:case e.DomainWarpType.OpenSimplex2Reduced:let t=(i+r)*(.5*(1.7320508075688772-1));i+=t,r+=t}let a=this._Seed,s=this._DomainWarpAmp*this._FractalBounding,n=this._Frequency;for(let e=0;e<this._Octaves;e++)this._DoSingleDomainWarp(a,s,n,t,i,r),a++,s*=this._Gain,n*=this._Lacunarity})(arguments[0]):1===arguments.length&&arguments[0]instanceof i?r(arguments[0]):void 0}_SingleDomainWarpBasicGrid(){let r=(t,i,r,a,s,n,o)=>{let l=s*r,h=n*r,_=o*r,c=Math.floor(l),p=Math.floor(h),u=Math.floor(_),d=e._InterpHermite(l-c),m=e._InterpHermite(h-p),R=e._InterpHermite(_-u);c*=this._PrimeX,p*=this._PrimeY,u*=this._PrimeZ;let f=c+this._PrimeX,g=p+this._PrimeY,D=u+this._PrimeZ,P=1020&this._HashR3(t,c,p,u),y=1020&this._HashR3(t,f,p,u),C=e._Lerp(this._RandVecs3D[P],this._RandVecs3D[y],d),T=e._Lerp(this._RandVecs3D[1|P],this._RandVecs3D[1|y],d),S=e._Lerp(this._RandVecs3D[2|P],this._RandVecs3D[2|y],d);P=1020&this._HashR3(t,c,g,u),y=1020&this._HashR3(t,f,g,u);let V=e._Lerp(this._RandVecs3D[P],this._RandVecs3D[y],d),b=e._Lerp(this._RandVecs3D[1|P],this._RandVecs3D[1|y],d),v=e._Lerp(this._RandVecs3D[2|P],this._RandVecs3D[2|y],d),G=e._Lerp(C,V,m),M=e._Lerp(T,b,m),L=e._Lerp(S,v,m);P=1020&this._HashR3(t,c,p,D),y=1020&this._HashR3(t,f,p,D),C=e._Lerp(this._RandVecs3D[P],this._RandVecs3D[y],d),T=e._Lerp(this._RandVecs3D[1|P],this._RandVecs3D[1|y],d),S=e._Lerp(this._RandVecs3D[2|P],this._RandVecs3D[2|y],d),P=1020&this._HashR3(t,c,g,D),y=1020&this._HashR3(t,f,g,D),V=e._Lerp(this._RandVecs3D[P],this._RandVecs3D[y],d),b=e._Lerp(this._RandVecs3D[1|P],this._RandVecs3D[1|y],d),v=e._Lerp(this._RandVecs3D[2|P],this._RandVecs3D[2|y],d),a.x+=e._Lerp(G,e._Lerp(C,V,m),R)*i,a.y+=e._Lerp(M,e._Lerp(T,b,m),R)*i,a.z+=e._Lerp(L,e._Lerp(S,v,m),R)*i};6===arguments.length&&arguments[3]instanceof t&&((t,i,r,a,s,n)=>{let o=s*r,l=n*r,h=Math.floor(o),_=Math.floor(l),c=e._InterpHermite(o-h),p=e._InterpHermite(l-_);h*=this._PrimeX,_*=this._PrimeY;let u=h+this._PrimeX,d=_+this._PrimeY,m=510&this._HashR2(t,h,_),R=510&this._HashR2(t,u,_),f=e._Lerp(this._RandVecs2D[m],this._RandVecs2D[R],c),g=e._Lerp(this._RandVecs2D[1|m],this._RandVecs2D[1|R],c);m=510&this._HashR2(t,h,d),R=510&this._HashR2(t,u,d);let D=e._Lerp(this._RandVecs2D[m],this._RandVecs2D[R],c),P=e._Lerp(this._RandVecs2D[1|m],this._RandVecs2D[1|R],c);a.x+=e._Lerp(f,D,p)*i,a.y+=e._Lerp(g,P,p)*i})(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),7===arguments.length&&arguments[3]instanceof i&&r(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6])}_SingleDomainWarpOpenSimplex2Gradient(){let e=(e,t,i,r,a,s,n,o)=>{s*=i,n*=i,o*=i;let l,h,_,c=Math.round(s),p=Math.round(n),u=Math.round(o),d=s-c,m=n-p,R=o-u,f=-d-1|1,g=-m-1|1,D=-R-1|1,P=f*-d,y=g*-m,C=D*-R;c*=this._PrimeX,p*=this._PrimeY,u*=this._PrimeZ,l=h=_=0;let T=.6-d*d-(m*m+R*R);for(let t=0;;t++){if(T>0){let t,i,r,s=T*T*(T*T);if(a){let a=1020&this._HashR3(e,c,p,u);t=this._RandVecs3D[a],i=this._RandVecs3D[1|a],r=this._RandVecs3D[2|a]}else{let a=this._HashR3(e,c,p,u),s=252&a,n=a>>6&1020,o=d*this._Gradients3D[s]+m*this._Gradients3D[1|s]+R*this._Gradients3D[2|s],l=this._RandVecs3D[n],h=this._RandVecs3D[1|n],_=this._RandVecs3D[2|n];t=o*l,i=o*h,r=o*_}l+=s*t,h+=s*i,_+=s*r}let i=T,r=c,s=p,n=u,o=d,S=m,V=R;if(P>=y&&P>=C?(o+=f,i=i+P+P,r-=f*this._PrimeX):y>P&&y>=C?(S+=g,i=i+y+y,s-=g*this._PrimeY):(V+=D,i=i+C+C,n-=D*this._PrimeZ),i>1){i-=1;let t,c,p,u=i*i*(i*i);if(a){let i=1020&this._HashR3(e,r,s,n);t=this._RandVecs3D[i],c=this._RandVecs3D[1|i],p=this._RandVecs3D[2|i]}else{let i=this._HashR3(e,r,s,n),a=252&i,l=i>>6&1020,h=o*this._Gradients3D[a]+S*this._Gradients3D[1|a]+V*this._Gradients3D[2|a],_=this._RandVecs3D[l],u=this._RandVecs3D[1|l],d=this._RandVecs3D[2|l];t=h*_,c=h*u,p=h*d}l+=u*t,h+=u*c,_+=u*p}if(1===t)break;P=.5-P,y=.5-y,C=.5-C,d=f*P,m=g*y,R=D*C,T+=.75-P-(y+C),c+=f>>1&this._PrimeX,p+=g>>1&this._PrimeY,u+=D>>1&this._PrimeZ,f=-f,g=-g,D=-D,e+=1293373}r.x+=l*t,r.y+=h*t,r.z+=_*t};7===arguments.length&&((e,t,i,r,a,s,n)=>{const o=.21132486540518713;s*=i,n*=i;let l,h,_=Math.floor(s),c=Math.floor(n),p=s-_,u=n-c,d=(p+u)*o,m=p-d,R=u-d;_*=this._PrimeX,c*=this._PrimeY,l=h=0;let f=.5-m;if(f>0){let t,i,r=f*f*(f*f);if(a){let r=510&this._HashR2(e,_,c);t=this._RandVecs2D[r],i=this._RandVecs2D[1|r]}else{let r=this._HashR2(e,_,c),a=254&r,s=r>>7&510,n=m*this._Gradients2D[a]+R*this._Gradients2D[1|a],o=this._RandVecs2D[s],l=this._RandVecs2D[1|s];t=n*o,i=n*l}l+=r*t,h+=r*i}let g=3.1547005383792506*d+(-.6666666666666666+f);if(g>0){let t,i,r=m+(2*o-1),s=R+(2*o-1),n=g*g*(g*g);if(a){let r=510&this._HashR2(e,_+this._PrimeX,c+this._PrimeY);t=this._RandVecs2D[r],i=this._RandVecs2D[1|r]}else{let a=this._HashR2(e,_+this._PrimeX,c+this._PrimeY),n=254&a,o=a>>7&510,l=r*this._Gradients2D[n]+s*this._Gradients2D[1|n],h=this._RandVecs2D[o],p=this._RandVecs2D[1|o];t=l*h,i=l*p}l+=n*t,h+=n*i}if(R>m){let t=m+o,i=R+(o-1),r=.5-t*t-i*i;if(r>0){let s,n,o=r*r*(r*r);if(a){let t=510&this._HashR2(e,_,c+this._PrimeY);s=this._RandVecs2D[t],n=this._RandVecs2D[1|t]}else{let r=this._HashR2(e,_,c+this._PrimeY),a=254&r,o=r>>7&510,l=t*this._Gradients2D[a]+i*this._Gradients2D[1|a],h=this._RandVecs2D[o],p=this._RandVecs2D[1|o];s=l*h,n=l*p}l+=o*s,h+=o*n}}else{let t=m+(o-1),i=R+o,r=.5-t*t-i*i;if(r>0){let s,n,o=r*r*(r*r);if(a){let t=510&this._HashR2(e,_+this._PrimeX,c);s=this._RandVecs2D[t],n=this._RandVecs2D[1|t]}else{let r=this._HashR2(e,_+this._PrimeX,c),a=254&r,o=r>>7&510,l=t*this._Gradients2D[a]+i*this._Gradients2D[1|a],h=this._RandVecs2D[o],p=this._RandVecs2D[1|o];s=l*h,n=l*p}l+=o*s,h+=o*n}}r.x+=l*t,r.y+=h*t})(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]),8===arguments.length&&e(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7])}}class t{constructor(e,t){this.x=e,this.y=t}}class i{constructor(e,t,i){this.x=e,this.y=t,this.z=i}}const r=(e,t)=>{const i=e.createBuffer({size:t*t*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.STORAGE,mappedAtCreation:!0}),r=new Float32Array(i.getMappedRange());for(let e=0,t=r.length;e<t;e++)r[e]=Math.random();return i.unmap(),i},a=(e,t)=>({buffer:e.createBuffer({size:t.byteLength,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM}),data:t,set(t){this.data.set(t),e.queue.writeBuffer(this.buffer,0,this.data)}}),s=(t,i,r)=>{const a=t.createBuffer({size:i*r*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.STORAGE,mappedAtCreation:!0}),s=new Float32Array(a.getMappedRange()),n=new e;n.SetSeed(Math.floor(2147483647*Math.random())),n.SetFractalType(e.FractalType.FBm),n.SetFrequency(.005);for(let e=0,t=0;t<r;t++)for(let r=0;r<i;r++,e++){const i=n.GetNoise(r,t);i>.1&&(s[e]=1+(i-.1)/.9)}return a.unmap(),a};class n{constructor({adapter:e,canvas:t,device:i,texture:r}){const a=navigator.gpu.getPreferredCanvasFormat(e);this.context=t.getContext("webgpu"),this.context.configure({alphaMode:"opaque",device:i,format:a}),this.geometry=(e=>{const t=e.createBuffer({size:36*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0});return new Float32Array(t.getMappedRange()).set([-1,-1,0,1,0,1,1,-1,0,1,1,1,1,1,0,1,1,0,1,1,0,1,1,0,-1,1,0,1,0,0,-1,-1,0,1,0,1]),t.unmap(),{buffer:t,count:6}})(i),this.pipeline=i.createRenderPipeline({layout:"auto",vertex:{module:i.createShaderModule({code:"\nstruct VertexOutput {\n  @builtin(position) position : vec4<f32>,\n  @location(0) uv : vec2<f32>,\n}\n\n@vertex\nfn main(@location(0) position : vec4<f32>, @location(1) uv : vec2<f32>) -> VertexOutput {\n  var out : VertexOutput;\n  out.position = position;\n  out.uv = uv;\n  return out;\n}\n"}),entryPoint:"main",buffers:[{arrayStride:6*Float32Array.BYTES_PER_ELEMENT,attributes:[{shaderLocation:0,offset:0,format:"float32x4"},{shaderLocation:1,offset:4*Float32Array.BYTES_PER_ELEMENT,format:"float32x2"}]}]},fragment:{module:i.createShaderModule({code:"\n@group(0) @binding(0) var mainSampler : sampler;\n@group(0) @binding(1) var mainTexture : texture_2d<f32>;\n\n@fragment\nfn main(@location(0) uv : vec2<f32>) -> @location(0) vec4<f32> {\n  return textureSample(mainTexture, mainSampler, uv);\n}\n"}),entryPoint:"main",targets:[{format:a}]},primitive:{topology:"triangle-list"}}),this.bindings=i.createBindGroup({layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:i.createSampler({magFilter:"nearest",minFilter:"nearest"})},{binding:1,resource:r}]})}render(e){const{bindings:t,context:i,geometry:r,pipeline:a}=this,s=e.beginRenderPass({colorAttachments:[{view:i.getCurrentTexture().createView(),loadOp:"load",storeOp:"store"}]});s.setPipeline(a),s.setBindGroup(0,t),s.setVertexBuffer(0,r.buffer),s.draw(r.count,1,0,0),s.end()}}const o="\nfn cellFromPos(pos : vec2<i32>) -> u32 {\n  return u32(pos.y * __WIDTH__ + pos.x); \n}\n",l=`\n@binding(0) @group(0) var<uniform> offset : vec2<i32>;\n@binding(1) @group(0) var<storage, read> world : array<f32>;\n@binding(2) @group(0) var<storage, read> waterState : array<f32>;\n@binding(3) @group(0) var<storage, read_write> waterStep : array<f32>;\n\n${o}\n\nconst maxMass : f32 = 1.0; // The un-pressurized mass of a full water cell\nconst maxCompress : f32 = 0.02; // How much excess water a cell can store, compared to the cell above it\nfn getStableState(totalMass : f32) -> f32 {\n  // This function is used to compute how water should be split among two vertically adjacent cells.\n  // It returns the amount of water that should be in the bottom cell.\n  if (totalMass <= 1.0) {\n    return 1.0;\n  }\n  if (totalMass < maxMass * 2.0 + maxCompress) {\n    return (maxMass * maxMass + totalMass * maxCompress) / (maxMass + maxCompress);\n  }\n  return (totalMass + maxCompress) / 2.0;\n}\n\nconst neighbors = array<vec2<i32>, 4>(\n  vec2<i32>(0, 1),\n  vec2<i32>(-1, 0),\n  vec2<i32>(1, 0),\n  vec2<i32>(0, -1),\n);\n\n@compute @workgroup_size(1)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {\n  var pos : vec2<i32> = vec2<i32>(GlobalInvocationID.xy) * 3 + offset;\n  var cell : u32 = cellFromPos(pos);\n  if (world[cell] > 0.0) {\n    return;\n  }\n  var mass : f32 = waterState[cell];\n  var remainingMass : f32 = mass;\n  for (var n : u32 = 0; remainingMass > 0.0 && n < 4; n++) {\n    var npos : vec2<i32> = pos + neighbors[n];\n    var neighbor : u32 = cellFromPos(npos);\n    var edge : bool = npos.x < 0 || npos.x >= __WIDTH__ || npos.y < 0 || npos.y >= __HEIGHT__;\n    if (edge || world[neighbor] == 0.0) {\n      var neighborMass : f32 = 0.0;\n      if (!edge) {\n        neighborMass = waterState[neighbor];\n      }\n      var flow : f32;\n      switch (n) {\n        default: { // Left || Right\n          // Equalize the amount of water between neighbors\n          flow = (mass - neighborMass) / 4.0f;\n        }\n        case 0: { // Down\n          flow = getStableState(remainingMass + neighborMass) - neighborMass;\n        }\n        case 3: { // Up\n          // Only compressed water flows upwards\n          flow = remainingMass - getStableState(remainingMass + neighborMass);\n        }\n      }\n      if (flow > 0.1) {\n        // Smooth flow\n        flow *= 0.5;\n      }\n      flow = clamp(flow, 0.0, min(1.0, remainingMass));\n      waterStep[cell] -= flow;\n      if (!edge) {\n        waterStep[neighbor] += flow;\n      }\n      remainingMass -= flow;\n    }\n  }\n}\n`,h=`\nstruct Params {\n  pointer : vec2<i32>,\n  button : i32,\n  size : i32,\n};\n\n@binding(0) @group(0) var<uniform> params : Params;\n@binding(1) @group(0) var<storage, read_write> world : array<f32>;\n@binding(2) @group(0) var<storage, read_write> waterState : array<f32>;\n@binding(3) @group(0) var<storage, read_write> waterStep : array<f32>;\n\n${o}\n\n@compute @workgroup_size(1)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {\n  for (var y : i32 = -params.size; y <= params.size; y++) {\n    for (var x : i32 = -params.size; x <= params.size; x++) {\n      var pos : vec2<i32> = vec2<i32>(params.pointer.x + x, params.pointer.y + y);\n      if (pos.x < 0 || pos.x >= __WIDTH__ || pos.y < 0 || pos.y >= __HEIGHT__ || length(vec2<f32>(f32(x), f32(y))) >= f32(params.size)) {\n        continue;\n      }\n      var cell : u32 = cellFromPos(pos);\n      switch (params.button) {\n        default: {\n          if (world[cell] == 0) {\n            waterState[cell] = 0.5;\n            waterStep[cell] = 0.5;\n          }\n        }\n        case 1: {\n          world[cell] = 1;\n          waterState[cell] = 0;\n          waterStep[cell] = 0;\n        }\n        case 2: {\n          world[cell] = 0;\n          waterState[cell] = 0;\n          waterStep[cell] = 0;\n        }\n      }\n    }\n  }\n}\n`,_=`\n@binding(0) @group(0) var<storage, read> world : array<f32>;\n@binding(1) @group(0) var<storage, read> water : array<f32>;\n@binding(2) @group(0) var<storage, read> noise : array<f32>;\n@binding(3) @group(0) var color : texture_storage_2d<rgba8unorm, write>;\n\n${o}\n\nfn getDither(pos : vec2<i32>, granularity : f32) -> f32 {\n  return mix(\n    -granularity,\n    granularity,\n    noise[u32((pos.y % __NOISE_SIZE__) * __NOISE_SIZE__ + (pos.x % __NOISE_SIZE__))]\n  );\n}\n\nfn getColor(pos : vec2<i32>) -> vec3<f32> {\n  var cell : u32 = cellFromPos(pos);\n  var value : f32 = world[cell];\n  if (value > 0.0) {\n    return (vec3<f32>(0.6, 0.4, 0.0) + getDither(pos, 0.03)) * (0.4 + min(value / 2.0, 0.8));\n  }\n  value = water[cell];\n  if (value > 0.001) {\n    return ((vec3<f32>(0.0, 0.0, 1.0) + getDither(pos, 0.06)) * (1.0 - min(value / 2.0, 0.8)));\n  }\n  return vec3<f32>(0.0, 0.0, 0.0);\n}\n\n@compute @workgroup_size(1)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {\n  var pos : vec2<i32> = vec2<i32>(GlobalInvocationID.xy);\n  textureStore(color, pos, vec4<f32>(getColor(pos), 1.0));\n}\n`;class c{constructor({canvas:e,width:t,height:i}){navigator.gpu.requestAdapter().then((e=>(this.adapter=e,e.requestDevice()))).then((o=>{this.device=o;const c=[s(o,t,i),...Array.from({length:2},((e,r)=>o.createBuffer({size:t*i*Float32Array.BYTES_PER_ELEMENT,usage:(0===r?GPUBufferUsage.COPY_DST:GPUBufferUsage.COPY_SRC)|GPUBufferUsage.STORAGE})))],p=o.createComputePipeline({layout:"auto",compute:{module:o.createShaderModule({code:h.replace(/__WIDTH__/g,t).replace(/__HEIGHT__/g,i)}),entryPoint:"main"}}),u=a(o,new Int32Array(4));this.update={bindings:o.createBindGroup({layout:p.getBindGroupLayout(0),entries:[u.buffer,...c].map(((e,t)=>({binding:t,resource:{buffer:e}})))}),pipeline:p,uniforms:u};const d=o.createComputePipeline({layout:"auto",compute:{module:o.createShaderModule({code:l.replace(/__WIDTH__/g,t).replace(/__HEIGHT__/g,i)}),entryPoint:"main"}}),m=a(o,new Int32Array(2));this.simulation={bindings:o.createBindGroup({layout:d.getBindGroupLayout(0),entries:[m.buffer,...c].map(((e,t)=>({binding:t,resource:{buffer:e}})))}),buffers:c,pipeline:d,uniforms:m,width:t,height:i};const R=o.createComputePipeline({layout:"auto",compute:{module:o.createShaderModule({code:_.replace(/__WIDTH__/g,t).replace(/__HEIGHT__/g,i).replace(/__NOISE_SIZE__/g,256)}),entryPoint:"main"}}),f=o.createTexture({size:{width:t,height:i},format:"rgba8unorm",usage:GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.TEXTURE_BINDING});this.output={bindings:o.createBindGroup({layout:R.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:c[0]}},{binding:1,resource:{buffer:c[1]}},{binding:2,resource:{buffer:r(o,256)}},{binding:3,resource:f.createView()}]}),pipeline:R},this.rasterizer=new n({adapter:this.adapter,canvas:e,device:o,texture:f.createView()}),this.isReady=!0}))}tick(e,t){const{simulation:i,device:r,output:a,rasterizer:s,update:n}=this;if(-1!==t.button){const e=r.createCommandEncoder(),a=e.beginComputePass();a.setPipeline(n.pipeline),a.setBindGroup(0,n.bindings),a.dispatchWorkgroups(1),a.end(),n.uniforms.set([Math.floor(t.x*i.width),Math.floor(t.y*i.height),t.button,t.size]),r.queue.submit([e.finish()])}for(let t=0;t<e;t++){for(let e=0;e<3;e++)for(let t=0;t<3;t++){const a=r.createCommandEncoder(),s=a.beginComputePass();s.setPipeline(i.pipeline),s.setBindGroup(0,i.bindings),s.dispatchWorkgroups(Math.ceil(i.width/3),Math.ceil(i.height/3)),s.end(),i.uniforms.set([t,e]),r.queue.submit([a.finish()])}const e=r.createCommandEncoder();e.copyBufferToBuffer(i.buffers[2],0,i.buffers[1],0,i.buffers[2].size),r.queue.submit([e.finish()])}const o=r.createCommandEncoder();{const e=o.beginComputePass();e.setPipeline(a.pipeline),e.setBindGroup(0,a.bindings),e.dispatchWorkgroups(i.width,i.height),e.end()}s.render(o),r.queue.submit([o.finish()])}}const p=1024,u=768,d=document.createElement("canvas");let m;document.getElementById("renderer").appendChild(d);const R=()=>{let e=window.innerWidth,t=window.innerHeight;1.3333333333333333>e/t?t=u*e/p:e=p*t/u,d.width=e,d.height=t,m=d.getBoundingClientRect()};window.addEventListener("resize",R,!1),R();const f={button:-1,size:10,x:0,y:0};window.addEventListener("contextmenu",(e=>e.preventDefault()),!1),window.addEventListener("mousemove",(({clientX:e,clientY:t})=>{f.x=(e-m.x)/m.width,f.y=(t-m.y)/m.height}),!1),window.addEventListener("mousedown",(({button:e})=>{f.button=e}),!1),window.addEventListener("mouseup",(({button:e})=>{f.button===e&&(f.button=-1)}),!1);let g=performance.now()/1e3;if(document.addEventListener("visibilitychange",(()=>{"visible"===document.visibilityState&&(g=performance.now()/1e3)}),!1),navigator.gpu&&navigator.gpu.getPreferredCanvasFormat){const e=new c({canvas:d,width:p,height:u}),t=()=>{requestAnimationFrame(t);const i=performance.now()/1e3,r=i-g;g=i,e.isReady&&e.tick(Math.min(Math.max(Math.floor(r/(1/600)),1),10),f)};requestAnimationFrame(t)}else document.getElementById("canary").classList.add("enabled")}();
